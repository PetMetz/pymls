
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymls.elastic &#8212; pymls  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pymls.elastic</h1><div class="highlight"><pre>
<span></span> <span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Mon Jun 27 14:40:09 2022</span>

<span class="sd">@author: pmetz1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># built-ins</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="c1"># 3rd party</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">LA</span>

<span class="c1"># package</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">toolbox</span> <span class="k">as</span> <span class="n">tbx</span>


<span class="c1"># --- constants</span>
<span class="n">_LAUE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span>           <span class="mi">2</span><span class="p">,</span>            <span class="mi">3</span><span class="p">,</span>              <span class="mi">4</span><span class="p">,</span>            <span class="mi">5</span><span class="p">,</span>            <span class="mi">6</span><span class="p">,</span>          <span class="mi">7</span><span class="p">,</span>          <span class="mi">8</span><span class="p">,</span>           <span class="mi">9</span><span class="p">,</span>           <span class="mi">10</span><span class="p">,</span>      <span class="mi">11</span>     <span class="p">),</span> <span class="c1"># integer Laue group</span>
    <span class="p">(</span><span class="s1">&#39;triclinic&#39;</span><span class="p">,</span> <span class="s1">&#39;monoclinic&#39;</span><span class="p">,</span> <span class="s1">&#39;orthorhombic&#39;</span><span class="p">,</span> <span class="s1">&#39;tetragonal&#39;</span><span class="p">,</span> <span class="s1">&#39;tetragonal&#39;</span><span class="p">,</span> <span class="s1">&#39;trigonal&#39;</span><span class="p">,</span> <span class="s1">&#39;trigonal&#39;</span><span class="p">,</span> <span class="s1">&#39;hexagonal&#39;</span><span class="p">,</span> <span class="s1">&#39;hexagonal&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">),</span> <span class="c1"># point symmetry</span>
    <span class="p">(</span><span class="s1">&#39;-1&#39;</span><span class="p">,</span>        <span class="s1">&#39;2/m&#39;</span><span class="p">,</span>        <span class="s1">&#39;mmm&#39;</span><span class="p">,</span>          <span class="s1">&#39;4/m&#39;</span><span class="p">,</span>        <span class="s1">&#39;4/mmm&#39;</span><span class="p">,</span>      <span class="s1">&#39;-3&#39;</span><span class="p">,</span>       <span class="s1">&#39;-3m&#39;</span><span class="p">,</span>      <span class="s1">&#39;6/m&#39;</span><span class="p">,</span>       <span class="s1">&#39;6/mmm&#39;</span><span class="p">,</span>     <span class="s1">&#39;m-3&#39;</span><span class="p">,</span>   <span class="s1">&#39;m-3m&#39;</span> <span class="p">)</span>  <span class="c1"># crystal system</span>
    <span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

<span class="n">O</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">conI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">row_stack</span><span class="p">((</span>
    <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">O</span><span class="p">,</span> <span class="n">I</span><span class="p">)),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">))</span>
    <span class="p">))</span>

<span class="c1"># FIXME didn&#39;t have a reference handy: https://link.springer.com/content/pdf/bbm%3A978-94-007-0350-6%2F1.pdf</span>
<span class="c1"># FIXME more convnient slicing if arranged in rows</span>
<span class="n">_ELASTIC_RESTRICTIONS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span>
  <span class="c1"># (1 , 2 , 3 , 4 , 5 , 6 , 7 , 8 , 9 , 10, 11), # Laue group</span>
    <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">),</span>
    <span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">44</span><span class="p">)</span>
    <span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># - conventions</span>
<span class="n">_voigt3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">_voigt6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">_voigt3</span><span class="p">)</span><span class="o">*</span><span class="n">_voigt3</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_voigt3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>


<span class="c1"># --- functions</span>
<div class="viewcode-block" id="generate_index"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.generate_index">[docs]</a><span class="k">def</span> <span class="nf">generate_index</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; ## -&gt; (#, #) &quot;&quot;&quot;</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="generate_indices"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.generate_indices">[docs]</a><span class="k">def</span> <span class="nf">generate_indices</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">generate_index</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="n">arg</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_unique"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.get_unique">[docs]</a><span class="k">def</span> <span class="nf">get_unique</span><span class="p">(</span><span class="n">LaueGroup</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">_ELASTIC_RESTRICTIONS</span><span class="p">[:,</span> <span class="n">LaueGroup</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># NB zero index</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rv</span><span class="p">[(</span><span class="n">rv</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rv</span><span class="o">!=</span><span class="mi">99</span><span class="p">)]))</span></div>


<div class="viewcode-block" id="parse_laue_class"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.parse_laue_class">[docs]</a><span class="k">def</span> <span class="nf">parse_laue_class</span><span class="p">(</span><span class="n">arg</span><span class="p">:(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduce various common inputs to integer representation.</span>

<span class="sd">    If crystal system is given, assumes the higher symmetry choice.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">arg</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">):</span> <span class="c1"># trivial case</span>
        <span class="k">return</span> <span class="n">arg</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># sanitize</span>
    <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">_LAUE</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">arg</span> <span class="o">==</span> <span class="n">_LAUE</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># by crystal system</span>
    <span class="k">elif</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">_LAUE</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">arg</span> <span class="o">==</span> <span class="n">_LAUE</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># by point symmetry</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;invalid Laue class: </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<span class="c1"># FIXME factor out for / if with masking?</span>
<div class="viewcode-block" id="cij_from_group"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.cij_from_group">[docs]</a><span class="k">def</span> <span class="nf">cij_from_group</span><span class="p">(</span><span class="o">*</span><span class="n">cij</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cij ordered i, j according to unique elements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># - helpers</span>
    <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span> <span class="c1"># NB zero index</span>
    <span class="c1"># - setup</span>
    <span class="n">laue</span> <span class="o">=</span> <span class="n">parse_laue_class</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># which laue group</span>
    <span class="n">unique</span> <span class="o">=</span> <span class="n">get_unique</span><span class="p">(</span><span class="n">laue</span><span class="p">)</span>       <span class="c1"># symmetry restricted unique values</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cij</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Unable to map </span><span class="si">{</span><span class="n">cij</span><span class="si">}</span><span class="s1"> to &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;c</span><span class="si">{</span><span class="n">ij</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">ij</span> <span class="ow">in</span> <span class="n">unique</span><span class="p">])</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>            <span class="c1"># return value</span>
    <span class="c1"># - map</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_ELASTIC_RESTRICTIONS</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">_ELASTIC_RESTRICTIONS</span><span class="p">[:,</span><span class="n">laue</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="c1"># short circuit zeros</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">99</span><span class="p">:</span>  <span class="c1"># this is only safe because it only occurs last</span>
            <span class="n">rv</span><span class="p">[</span><span class="n">generate_index</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rv</span><span class="p">[</span><span class="n">generate_index</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">*</span> <span class="n">cij</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">unique</span><span class="o">==</span><span class="nb">abs</span><span class="p">(</span><span class="n">key</span><span class="p">)))]</span>
    <span class="c1"># - diagonally symmetric</span>
    <span class="k">return</span> <span class="n">rv</span> <span class="o">+</span> <span class="n">rv</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">rv</span><span class="o">.</span><span class="n">diagonal</span><span class="p">())</span></div>


<div class="viewcode-block" id="cij_from_vector"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.cij_from_vector">[docs]</a><span class="k">def</span> <span class="nf">cij_from_vector</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="o">*</span><span class="n">cij</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; alias &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cij_from_group</span><span class="p">(</span><span class="o">*</span><span class="n">cij</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span></div>


<div class="viewcode-block" id="cij_from_dict"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.cij_from_dict">[docs]</a><span class="k">def</span> <span class="nf">cij_from_dict</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="o">**</span><span class="n">cij</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; from dict &quot;&quot;&quot;</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">cij_order</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cij</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cij</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">keys</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">cij_from_group</span><span class="p">(</span><span class="o">*</span><span class="n">elements</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span></div>


<div class="viewcode-block" id="cij_order"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.cij_order">[docs]</a><span class="k">def</span> <span class="nf">cij_order</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
    <span class="n">laue</span> <span class="o">=</span> <span class="n">parse_laue_class</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">get_unique</span><span class="p">(</span><span class="n">laue</span><span class="p">)</span></div>


<span class="c1"># FIXME unused</span>
<span class="k">def</span> <span class="nf">_compact</span><span class="p">(</span><span class="n">X</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>


<div class="viewcode-block" id="contract_ijkl"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.contract_ijkl">[docs]</a><span class="k">def</span> <span class="nf">contract_ijkl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Ting, Anisotropic Elasticity: Theory and Applications. (1996) eqn. 2.3-5b &quot;&quot;&quot;</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">contract_ij</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">contract_ij</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span></div>


<span class="k">def</span> <span class="nf">contract_ij</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Ting, Anisotropic Elasticity: Theory and Applications. (1996) eqn. 2.3-1 &quot;&quot;&quot;</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">i</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">j</span> <span class="k">else</span> <span class="mi">9</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">index</span><span class="p">)</span>


<span class="c1"># --- classes</span>
<div class="viewcode-block" id="Stroh"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.Stroh">[docs]</a><span class="k">class</span> <span class="nc">Stroh</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Elastic aspects of the dislocation contrast factor obtained by solution to</span>
<span class="sd">    the Stroh formulation.</span>

<span class="sd">    Reference</span>
<span class="sd">    ---------</span>
<span class="sd">        Ting, T.C.T. (1996) Elastic Anisotropy. ISBN 9780195074475</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># - class state</span>
    <span class="n">_flag_N</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_flag_eig</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="Stroh.reset"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.Stroh.reset">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Reset class state. &quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_flag_N</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_flag_eig</span> <span class="o">=</span> <span class="mi">1</span></div>

    <span class="c1"># - overloads</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;Stroh(cij=</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cij</span><span class="si">}</span><span class="s1">, crystalSystem=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crystalsystem</span><span class="si">}</span><span class="s1">) @ </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="si">}</span><span class="s1">&gt;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">cij</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">crystalSystem</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Elastic aspects of the dislocation contrast factor obtained by solution to</span>
<span class="sd">        the Stroh formulation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cij : np.ndarray, optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>
<span class="sd">        crystalSystem : str, optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>

<span class="sd">        Reference</span>
<span class="sd">        ---------</span>
<span class="sd">        Ting, T.C.T. (1996) Elastic Anisotropy. ISBN 9780195074475</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cij</span> <span class="o">=</span> <span class="n">cij</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crystalsystem</span> <span class="o">=</span> <span class="n">crystalSystem</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cijkl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Elastic stiffness tensor. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cijkl</span>

    <span class="nd">@cijkl</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cijkl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cijkl</span> <span class="o">=</span> <span class="n">X</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cij</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Reduced stiffness matrix. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mandel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cijkl</span><span class="p">)</span>

    <span class="nd">@cij</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cij</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cijkl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invert_mandel</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<div class="viewcode-block" id="Stroh.apply_voigt"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.Stroh.apply_voigt">[docs]</a>    <span class="k">def</span> <span class="nf">apply_voigt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply Voigt reduction scheme to X(3,3) to produce X2(6,).</span>
<span class="sd">        11 -&gt; 1; 22 -&gt; 2; 33 -&gt; 3; 23 -&gt; 4; 13 -&gt; 5; 12 -&gt; 6</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">_voigt3</span><span class="p">])</span></div>

<div class="viewcode-block" id="Stroh.invert_voigt"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.Stroh.invert_voigt">[docs]</a>    <span class="k">def</span> <span class="nf">invert_voigt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a Voigt reduced vector, reconstruct 2nd order tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_voigt3</span><span class="p">):</span>
            <span class="n">a</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pt</span><span class="p">)]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">a</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pt</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">a</span></div>

<div class="viewcode-block" id="Stroh.apply_mandel"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.Stroh.apply_mandel">[docs]</a>    <span class="k">def</span> <span class="nf">apply_mandel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The extension of Voigt reduction to the 4th rank tensor representing</span>
<span class="sd">        proportionality of two 2nd rank tensors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">_voigt6</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)],</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span></div>

    <span class="c1"># FIXME can&#39;t this be vectorized?</span>
<div class="viewcode-block" id="Stroh.invert_mandel"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.Stroh.invert_mandel">[docs]</a>    <span class="k">def</span> <span class="nf">invert_mandel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a Voigt reduced 2nd order tensor, reconstruct 4th order tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="c1"># - form index</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elastic_symmetry</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># - apply mapping</span>
        <span class="k">for</span> <span class="n">ijkl</span> <span class="ow">in</span> <span class="n">I0</span><span class="p">:</span>
            <span class="n">mn</span> <span class="o">=</span> <span class="n">contract_ijkl</span><span class="p">(</span><span class="o">*</span><span class="n">ijkl</span><span class="p">)</span>
            <span class="n">a</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ijkl</span><span class="p">)]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">mn</span><span class="p">)]</span>
        <span class="c1"># - exhaustive equivalence</span>
        <span class="k">for</span> <span class="n">Ip</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span> <span class="n">Ip</span><span class="p">):</span>
                <span class="n">a</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">jdx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">a</span></div>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">elastic_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; form symmetry equivalents ijks = jiks = ksij = ijsk &quot;&quot;&quot;</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># 3, 3, 3, 3, 4</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)))</span> <span class="c1"># -1, 4</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># form symmetry equivalents ijks = jiks = ksij = ijsk</span>
        <span class="n">rv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">I</span><span class="p">[:,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span> <span class="p">)</span> <span class="c1"># ijks</span>
        <span class="n">rv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">I</span><span class="p">[:,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span> <span class="p">)</span> <span class="c1"># jiks</span>
        <span class="n">rv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">I</span><span class="p">[:,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span> <span class="p">)</span> <span class="c1"># ksij</span>
        <span class="n">rv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">I</span><span class="p">[:,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span> <span class="p">)</span> <span class="c1"># ijsk</span>
        <span class="k">return</span> <span class="n">rv</span>

    <span class="c1"># FIXME can&#39;t this be vectorized?</span>
<div class="viewcode-block" id="Stroh.apply_elastic_symmetry"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.Stroh.apply_elastic_symmetry">[docs]</a>    <span class="k">def</span> <span class="nf">apply_elastic_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">I0</span><span class="p">,</span> <span class="o">*</span><span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elastic_symmetry</span>
        <span class="c1"># - exhaustive equivalence</span>
        <span class="k">for</span> <span class="n">Ip</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">jdx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">I0</span><span class="p">,</span> <span class="n">Ip</span><span class="p">):</span>
                <span class="n">X</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">jdx</span><span class="p">)]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">X</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">crystalsystem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: crystal symmetry not yet implemented&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crystalsystem</span>

    <span class="nd">@crystalsystem</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">crystalsystem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crystalsystem</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># FIXME incomplete</span>
<div class="viewcode-block" id="Stroh.apply_crystal_symmetry"><a class="viewcode-back" href="../../rst/elastic.html#pymls.contrast.Stroh.apply_crystal_symmetry">[docs]</a>    <span class="k">def</span> <span class="nf">apply_crystal_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">Q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        c.f. pp 137 Ting, Elastic Anisotropy.</span>

<span class="sd">        .. math::</span>

<span class="sd">            Q_{ik} = C_{i1k1}</span>

<span class="sd">            Q =</span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">                C_{11} &amp; C_{16} &amp; C_{15} \\</span>
<span class="sd">                C_{16} &amp; C_{66} &amp; C_{56} \\</span>
<span class="sd">                C_{15} &amp; C_{56} &amp; C_{55}</span>
<span class="sd">            \end{bmatrix}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span> <span class="c1"># NB zero index</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">],</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">R</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        c.f. pp 137 Ting, Elastic Anisotropy.</span>

<span class="sd">        .. math::</span>

<span class="sd">            R_{ik} = C_{i1k2}</span>

<span class="sd">            R =</span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">                C_{16} &amp; C_{12} &amp; C_{14} \\</span>
<span class="sd">                C_{66} &amp; C_{26} &amp; C_{46} \\</span>
<span class="sd">                C_{56} &amp; C_{25} &amp; C_{45}</span>
<span class="sd">            \end{bmatrix}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span> <span class="c1"># NB zero index</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">],</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        c.f. pp 137 Ting, Elastic Anisotropy.</span>

<span class="sd">        .. math::</span>

<span class="sd">            T_{ij} = C_{i2k2}</span>

<span class="sd">            T =</span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">                C_{66} &amp; C_{26} &amp; C_{46} \\</span>
<span class="sd">                C_{26} &amp; C_{22} &amp; C_{24} \\</span>
<span class="sd">                C_{46} &amp; C_{24} &amp; C_{44}</span>
<span class="sd">            \end{bmatrix}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
               <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span> <span class="c1"># NB zero index</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">],</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">N1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        c.f. pp 144 Ting, Elastic Anisotropy.</span>

<span class="sd">        .. math::</span>
<span class="sd">            N_1 = -T^{-1} R^T \ \  [-]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">N2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        c.f. pp 144 Ting, Elastic Anisotropy.</span>

<span class="sd">        .. math::</span>
<span class="sd">            N_2 = T^{-1} \ \ [m^2 \cdot N^{-1}]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">N3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        c.f. pp 144 Ting, Elastic Anisotropy.</span>

<span class="sd">        .. math::</span>
<span class="sd">            N_3 = R T^{-1} R^T - Q \ \ [N \cdot m^{-2}]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">@</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">N</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        c.f. pp 144 Ting, Elastic Anisotropy.</span>

<span class="sd">        fundamental elasticity matrix (Ingebrigtsen &amp; Tonning, 1969)</span>

<span class="sd">        .. math::</span>

<span class="sd">            N =</span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">                N_1 &amp; N_2 \\</span>
<span class="sd">                N_3 &amp; N_1^T</span>
<span class="sd">            \end{bmatrix}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag_N</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_N</span> <span class="o">=</span> <span class="n">tbx</span><span class="o">.</span><span class="n">square</span><span class="p">((</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N2</span>  <span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_flag_N</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        eigenvalues (6,) of the fundamental elasticity matrix</span>

<span class="sd">        .. math::</span>

<span class="sd">            N \xi = p \xi</span>

<span class="sd">            N = \begin{bmatrix}</span>
<span class="sd">                    N_1 &amp; N_2 \\</span>
<span class="sd">                    N_3 &amp; N_1^T</span>
<span class="sd">                \end{bmatrix},</span>

<span class="sd">            \xi = \begin{bmatrix}</span>
<span class="sd">                    a \\ l</span>
<span class="sd">                  \end{bmatrix}</span>

<span class="sd">        Ref:</span>
<span class="sd">            Ting, T.C.T. (1996) Elastic Anisotropy. c.f. eqn. 5.5-3 pp. 144</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag_eig</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xi</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="c1"># The normalized (unit &quot;length&quot;) eigenvectors, such that the column v[:,i] is the eigenvector corresponding to the eigenvalue w[i].</span>
            <span class="c1"># self._xi = self._xi.T # 20230209</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_flag_eig</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">xi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Right eigenvectors (6,6) of :math:`N \xi = p \xi`, see `p`.</span>

<span class="sd">        .. math::</span>

<span class="sd">            \xi = \begin{bmatrix}</span>
<span class="sd">                    a \\ l \\</span>
<span class="sd">                  \end{bmatrix}</span>

<span class="sd">        Ref:</span>
<span class="sd">            Ting, T.C.T. (1996) Elastic Anisotropy. c.f. eqn. 5.5-3 pp. 144</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flag_eig</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xi</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="c1"># The normalized (unit &quot;length&quot;) eigenvectors, such that the column v[:,i] is the eigenvector corresponding to the eigenvalue w[i].</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_flag_eig</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xi</span> <span class="c1"># .round(tbx._PREC)</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">eta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Left eigenvectors (6,6) of :math:`N^T \eta = p \eta`, see `p`.</span>

<span class="sd">        .. math::</span>

<span class="sd">            \eta = \begin{bmatrix}</span>
<span class="sd">                    l \\ a \\</span>
<span class="sd">                  \end{bmatrix}</span>

<span class="sd">        Ref:</span>
<span class="sd">            Ting, T.C.T. (1996) Elastic Anisotropy. c.f. eqn. 5.5-3 pp. 144</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># return np.row_stack((self.l, self.a)) # &quot;... the left eigenvector... are in the reverse order&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">conI</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="c1"># .round(tbx._PREC) # this is equivalent</span>
        <span class="c1"># return self.xi[::-1] # apparently Ting means the former, not reversal by index</span>

    <span class="c1"># FIXME for some reason np.eig returns column major eigen vectors? This slicing should be adjusted?</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stroh eigenvectors (6,6) solutions to the fundamental elasticity matrix</span>
<span class="sd">        The eigenvector `a` represents the direction of the displacement.</span>

<span class="sd">        c.f. Ting eqn. 5.5-4 &amp; 5.3-11</span>
<span class="sd">        NB scipy.linalg.eig returns column eigenvectors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:]</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">l</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stroh eigenvectors (6,6) solutions to the fundamental elasticity matrix</span>
<span class="sd">        The eigenvector `l` represents the direction of traction.</span>

<span class="sd">        c.f. Ting eqn. 5.5-4 &amp; 5.3-11</span>
<span class="sd">        NB scipy.linalg.eig returns column eigenvectors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">[</span><span class="mi">3</span><span class="p">:,:]</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stroh eigen vectors (3,3) obeying :math:`a_{\alpha+3} = \bar{a}_{\alpha}`</span>
<span class="sd">        (i.e. half the roots of the sextic equation)</span>
<span class="sd">        :math:`A = [a1, a2, a3]` (NB column vectors) (c.f. Ting eqn. 5.5-4 &amp; 5.3-11)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stroh eigen vectors (3,3) obeying :math:`l_{\alpha+3} = \bar{l}_{\alpha}`</span>
<span class="sd">        (i.e. half the roots of the sextic equation)</span>
<span class="sd">        :math:`B = [b1, b2, b3]` (NB column vectors) (c.f. Ting eqn. 5.5-4 &amp; 5.3-11)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stroh eigen values (3,) obeying :math:`p_{\alpha+3} = \bar{p}_{\alpha}`</span>
<span class="sd">        (i.e. half the roots of the sextic equation)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">M</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :math:`M_{\alpha i} L_{i \beta} = \partial _{\alpha \beta}`</span>
<span class="sd">        ref: Stroh (1958) Dislocations and cracks in anisotropic elasticity pp. 631</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LA</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">cached_property</span>
    <span class="k">def</span> <span class="nf">B</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :math:`B_{ij} = 1/2 i \sum_{\alpha}(A_{i \alpha} M_{\alpha j} - \bar{A}_{i \alpha} \bar{M}_{\alpha j})`</span>
<span class="sd">        ref: Stroh (1958) Dislocations and cracks in anisotropic elasticity pp. 631</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">))</span></div>

    <span class="c1"># FIXME These letters from Ting clash with the nomenclature of Stroh</span>
    <span class="c1"># --- from Ting ch. 5</span>
<span class="c1"># =============================================================================</span>
<span class="c1">#     @functools.cached_property</span>
<span class="c1">#     def S(self):</span>
<span class="c1">#         r&quot;&quot;&quot;</span>
<span class="c1">#         Barnett-Lothe tensors</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         return 1j * (2*self.A @ self.B.T - np.eye(3))</span>
<span class="c1">#</span>
<span class="c1">#     @functools.cached_property</span>
<span class="c1">#     def H(self):</span>
<span class="c1">#         r&quot;&quot;&quot;</span>
<span class="c1">#         Barnett-Lothe tensors</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         return 2j * self.A @ self.A.T</span>
<span class="c1">#</span>
<span class="c1">#     @functools.cached_property</span>
<span class="c1">#     def L(self):</span>
<span class="c1">#         r&quot;&quot;&quot;</span>
<span class="c1">#         Barnett-Lothe tensors</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         return -2j * self.L @ self.L.T</span>
<span class="c1"># =============================================================================</span>

    <span class="c1"># End Stroh</span>


</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">pymls</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst/contrast.html">contrast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst/elastic.html">elastic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst/geometric.html">geometric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst/lattice.html">lattice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst/symmetry.html">symmetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst/toolbox.html">toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst/voigt.html">voigt</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Peter C. Metz.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>